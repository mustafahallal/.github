name: Metrics

on:
  schedule:
    - cron: '0 0 * * *' # Her gece yarısı
  workflow_dispatch:

concurrency:
  group: metrics-${{ github.repository }}
  cancel-in-progress: true

# Top-level izin: çıktıyı repoya yazmak için write gerekli
permissions:
  contents: write
  actions: read

jobs:
  github-metrics:
    name: Generate organization metrics
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate metrics SVG
        # LOG'da gördüğün versiyon 3.34.0 idi; reproducibility için o tag/sha ile pinle.
        # Eğer başka stabil bir tag/sha varsa onu kullan.
        uses: lowlighter/metrics@v3.34.0
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: mustafahallal
          base: ""
          user_type: organization

          # Organizasyon bağlamında commit takvimi (isocalendar) desteklenmediği
          # için kapalı bırakıyoruz. Eğer ileride bu eklenti organizasyon için
          # desteklenirse 'true' yapabiliriz.
          plugin_isocalendar: 'false'
          plugin_isocalendar_duration: 'full-year'

          # Eğer private repoları dahil etmek istersen, token'da repo scope olmalı.
          # Bu alan bazı sürümlerde desteklenir; action dokümantasyonuna göre
          # configure et. Burayı bırakmak genelde yeterli olur.
          # include_private: 'true'

          filename: github-metrics.svg

      - name: Commit & push generated SVG
        if: ${{ success() }}
        run: |
          echo "Metrics generated: github-metrics.svg"
