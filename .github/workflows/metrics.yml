name: Metrics

on:
  schedule:
    - cron: '0 0 * * *' # Her gece yarısı
  workflow_dispatch:

concurrency:
  group: metrics-${{ github.repository }}
  cancel-in-progress: true

# Top-level permission: oluşturulan görseli repoya yazmak için gerekli
permissions:
  contents: write
  actions: read

jobs:
  github-metrics:
    name: Generate organization metrics
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate metrics SVG
        # PIN the action to a stable tag or SHA for reproducibility.
        # Replace `@v1` with the specific version/sha recommended by the action's repo.
        uses: lowlighter/metrics@v1
        with:
          # Repo Secrets -> METRICS_TOKEN olarak eklenmiş PAT veya token
          token: ${{ secrets.METRICS_TOKEN }}
          user: mustafahallal
          base: ""
          user_type: organization
          plugin_isocalendar: 'true'
          plugin_isocalendar_duration: 'full-year'
          filename: github-metrics.svg

      - name: Success message
        if: ${{ success() }}
        run: echo "Metrics generated (github-metrics.svg)."
